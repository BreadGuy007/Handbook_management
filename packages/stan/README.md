# Stan

"stan" stands for "state" in Polish ðŸ‡µðŸ‡±. It's a framework agnostic library to manage distributed state in JavaScript application. It is highly inspired by the equivalent [Recoil](https://recoiljs.org/) and [jotai](https://jotai.surge.sh)

It share the same goals as Recoil and Jotai:

-   Based on atoms (or observables) which means it's highly performant at scale - only what needs to update gets updated.
-   Shares with Jotai the goal of maintaining a very light API surface.
-   Supports async and sync state.

Unlike these frameworks, it has the following goals that justified the creation of a separate library:

-   It is independent from other libraries like React. You can create binding for any of your desired frameworks.
-   It needs to be flexible enough to offer bindings for `@wordpress/data` consumer API (`useSelect` and `useDispatch`).

## Installation

Install the module

```bash
npm install @wordpress/stan --save
```

_This package assumes that your code will run in an **ES2015+** environment. If you're using an environment that has limited or no support for ES2015+ such as lower versions of IE then using [core-js](https://github.com/zloirock/core-js) or [@babel/polyfill](https://babeljs.io/docs/en/next/babel-polyfill) will add support for these methods. Learn more about it in [Babel docs](https://babeljs.io/docs/en/next/caveats)._

## Getting started

Stan is based on the concept of "atoms". Atoms are discrete state units and your application state is a tree of atoms that depend on each other.

### Creating basic atoms

Let's create some basic atoms:

```js
import { createAtom } from '@wordpress/stan';

// Creates an atom with an initial value of 1.
// The value can be of any type.
const counter = createAtom( 1 );
```

### Manipulating atoms

In this example we created an atom that can hold a counter that starts with `1`. 
To manipulate we need a registry. The registry is the container of all atom states.

```js
import { createAtomRegistry } from '@wordpress/stan';

const registry = createAtomRegistry();

// Read the counter.
console.log( registry.get( counter ) ); //  prints 1.

// Modify the value of the counter
registry.set( counter, 10 );

console.log( registry.get( counter ) ); //  prints 10.
```

### Subscribing to changes

Each atom is an observable to which we can subscribe:

```js
registry.subscribe( counter, () => {
    console.log( registry.get( counter ) );
} );

registry.set( counter, 2 ); // prints 2.
registry.set( counter, 4 ); // prints 4.
```

### Derived atoms

Atoms can also derive their value based on other atoms. We call these "derived atoms".

```js
import { createAtom, createDerivedAtom } from '@wordpress/stan';

const counter1 = createAtom( 1 );
const counter2 = createAtom( 2 );
const sum = createDerivedAtom(
    ( { get } ) => get( counter1 ) + get( counter2 )
);
```

In the example above, we create two simple counter atoms and third derived "sum" atom which value is the sum of both counters.

```js
console.log( registry.get( sum ) ); // prints 3.

// Adding a listener automatically triggers the refreshing of the value.
// If the atom has no subscriber, it will only attempt a resolution when initially read. 
// But it won't bother refreshing its value, if any of its dependencies change.
// This property (laziness) is important for performance reasons.
registry.subscribe( sum, () => {
    console.log( registry.get( sum ) );
} );

// This edits counter1, triggering a resolution of sumInstance which triggers the console.log above.
registry.set( counter1, 2 ); // now both counters equal 2 which means sum will print 4.
registry.set( counter1, 4 ); // prints 6
```

### Async derived atoms

Derived atoms can use async functions to compute their values. They can for instance trigger some REST API call and returns a promise.

```js
const sum2 = createDerivedAtom(
    async ( { get } ) => {
        const val1 = await Promise.resolve( 10 );
        return val1 * get( counter );
    } 
);
```

The value of async atoms will be equal to `null` until the resolution function finishes.

### Bindings

It is important to note that stan instance and registries are low-level APIs meant to be used by developers to build bindings for frameworks of their choice. In general, a higher-level API is preferred.

Currently available bindings:

-   `@wordpress/data`: WordPress data users can continue to use their existing high-level APIs `useSelect`/`useDispatch` (selectors and actions) to access the atoms. The selectors are just high-level atoms that can rely on lower-level ones and the actions are just functions that trigger atom setters. The API for `@wordpress/data` store authors to bridge the gap is still experimental.

## API Reference

<!-- START TOKEN(Autogenerated API docs) -->

<a name="createAtom" href="#createAtom">#</a> **createAtom**

Creates a basic atom.

_Parameters_

-   _initialValue_ `T`: Initial value in the atom. \*
-   _config_ `[WPCommonAtomConfig]`: Common Atom config.

_Returns_

-   `WPAtom<T>`: Created atom.

<a name="createAtomRegistry" href="#createAtomRegistry">#</a> **createAtomRegistry**

Creates a new Atom Registry.

_Parameters_

-   _onAdd_ `RegistryListener`: 
-   _onDelete_ `RegistryListener`: 

_Returns_

-   `WPAtomRegistry`: Atom Registry.

<a name="createAtomSelector" href="#createAtomSelector">#</a> **createAtomSelector**

_Parameters_

-   _resolver_ `WPAtomSelectorResolver<T>`: Atom resolver.
-   _updater_ `WPAtomSelectorUpdater<T>`: Atom updater.
-   _atomConfig_ `[WPCommonAtomConfig]`: Common Atom config.

_Returns_

-   (unknown type): Atom selector creator.

<a name="createDerivedAtom" href="#createDerivedAtom">#</a> **createDerivedAtom**

Creates a derived atom.

_Parameters_

-   _resolver_ `WPDerivedAtomResolver<T>`: Atom resolver.
-   _updater_ `WPDerivedAtomUpdater<T>`: Atom updater.
-   _config_ `[WPCommonAtomConfig]`: Common Atom config.

_Returns_

-   `WPAtom<T>`: Created atom.

<a name="createStoreAtom" href="#createStoreAtom">#</a> **createStoreAtom**

Creates a store atom.

_Parameters_

-   _subscribe_ (unknown type): Subscribe to state changes.
-   _get_ (unknown type): Get the state value.
-   _dispatch_ (unknown type): Dispatch store changes,
-   _config_ `[WPCommonAtomConfig]`: Common Atom config.

_Returns_

-   `WPAtom<T>`: Store Atom.

<a name="createStoreAtomSelector" href="#createStoreAtomSelector">#</a> **createStoreAtomSelector**

_Parameters_

-   _subscribe_ (unknown type): Subscribe to state changes.
-   _get_ (unknown type): Get the state value.
-   _dispatch_ (unknown type): Dispatch store changes,
-   _atomConfig_ `[WPCommonAtomConfig]`: Common Atom config.

_Returns_

-   (unknown type): Atom selector creator.


<!-- END TOKEN(Autogenerated API docs) -->

<br/><br/><p align="center"><img src="https://s.w.org/style/images/codeispoetry.png?1" alt="Code is Poetry." /></p>
